---
# tasks file for doing yum related tasks

- name: Update CentOS host packages.
  yum:
    name: '*'
  when: >
    ansible_distribution == 'CentOS'
    or
    ansible_distribution == 'Red Hat Enterprise Linux'

- name: Update Ubuntu host packages.
  apt:
    upgrade: dist
  when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'

- name: Install CentOS dependencies needed for Molecule on host.
  yum:
    name:
      - git
      - device-mapper-persistent-data
      - lvm2
      - python-devel
      - gcc
      - openssl-devel
      - libselinux-python
    state: present
  when: >
    ansible_distribution == 'CentOS'
    or
    ansible_distribution == 'Red Hat Enterprise Linux'

- name: Install Ubuntu dpependencies needed for Molecule on host.
  apt:
    name:
      - apt-transport-https
      - ca-certificates
      - curl
      - software-properties-common
      - gcc
      - python-dev
    state: present
  when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'

- name: Download pip install script.
  get_url:
    url: https://bootstrap.pypa.io/get-pip.py
    dest: /tmp/get-pip.py
    mode: 0777
  notify:
    - run pip script

- name: pip install molecule and docker.
  pip:
    name:
      - molecule
      - docker
